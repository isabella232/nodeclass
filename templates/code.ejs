/*** COMPILED BY NODECLASS ********************************************************************************************/
(function createConstructor(Class) {
    var Constructor;

    function Properties(Instance, Super) {
        <%= $generate.methodBindings($classMap) %>
        this.Instance = Instance;
        this.Super = Super;
    }
    Properties.prototype = Class;

    (function () { <% /* self-executing function is necessary here because of shitty IE @see http://perfectionkills.com/a-closer-look-at-expression-closures/ */ %>
    Constructor = function <%= $classMap.className %>() {
        var instructions = Constructor["@"],
            constructAsSuperClass,
            properties,
            overriddenMethods,
            Super,
            Instance = this,
            key;

        if (this === undefined) {
            throw new Error("(nodeclass) Cannot create Class: You're trying to instantiate a class without the new operator");
        }

        if (instructions) {
            if (instructions.doNothing) {
                <% /* doNothing is necessary to make the instanceof operator work */ %>
                delete Constructor["@"];
                return;
            }
            Instance = instructions.Instance || this; <% /* provides the reference to the first child class that can be obtained via this.Instance */ %>
            constructAsSuperClass = instructions.constructAsSuperClass; <% /* if true, the constructor function exposes all protected class members */ %>
            overriddenMethods = instructions.overriddenMethods;
        }

        <% if ($superProperties) { %>
        Super = function () {
            properties.Super = Class.Extends.$construct({
                constructAsSuperClass: true,
                exportProtected: true,
                overriddenMethods: overriddenMethods,
                Instance: Instance
            }, arguments);
            return properties.Super;
        };
        <% } %>

        properties = new Properties(Instance, Super);

        <% /* Exporting all public methods */ %>
        <%= $generate.publicExports($classMap) %>
        this.Class = Constructor;

        <% /* Exporting all protected methods */ %>
        if (constructAsSuperClass) {
            <%= $generate.protectedExports($classMap) %>
        }

        <% /* Creating overriddenMethods-object */ %>
        <% if ($superProperties && _($classMap.overriddenMethods).keys().length > 0) { %>
        overriddenMethods = overriddenMethods || {};
        <% _($classMap.overriddenMethods).each(function printOverriddenMethods(method, methodName) { %>
        overriddenMethods.<%= methodName %> = overriddenMethods.<%= methodName %> || properties.<%= methodName %>;
        <% }); %>
        <% } %>

        <% /* Overriding methods of properties-object */ %>
        for (key in overriddenMethods) {
            if (overriddenMethods.hasOwnProperty(key)) {
                properties[key] = overriddenMethods[key];
            }
        }

        <% /* Now we're calling the init-function */ %>
        <% if ($classMap.hasInit) { %>
        Class.init.apply(properties, arguments);
        <% } %>

        <% if ($superProperties) { %>
            <% /* if the init-function hasn't called this.Super() it's called now */ %>
        if (typeof properties.Super === "function") {
            Super.apply(null, arguments);
        };
        Super = properties.Super;

            <% /* Exporting all public super methods */ %>
            <%= $generate.superPublicExports($classMap) %>

            <% /* Exporting all protected super methods */ %>
        if (constructAsSuperClass) {
            <%= $generate.superProtectedExports($classMap) %>
        }
        <% } %>

        delete Constructor["@"];
    };
    }());

    <% /* Attaching static properties */ %>
    <%= $generate.staticExports($classMap) %>

    <% /* this special function is used to call the constructor with an argument-array since you cant use the .apply()-method with the new operator. */ %>
    Constructor.$construct = function (instructions, args) {
        function <%= $classMap.className %>() {
            return Constructor.apply(this, args || []);
        }
        <%= $classMap.className %>.prototype = Constructor.prototype;

        Constructor["@"] = instructions;

        return new <%= $classMap.className %>();
    };

    <% if ($superProperties) { %>
    Constructor.prototype = Class.Extends.$construct({
        doNothing: true
    });
    <% } %>

    Constructor.Extends = Class.Extends;
    module.exports = Constructor;
    if (typeof <%= $classMap.className %> !== "undefined") {
        <%= $classMap.className %> = Constructor;
    }


})(module.exports);
/**********************************************************************************************************************/